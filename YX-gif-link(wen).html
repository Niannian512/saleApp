<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" href="fonts/iconfont.css">
		<link rel="stylesheet" type="text/css" href="css/active.css">
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/rem-font-size.js"></script>
		<title>营销-动图-外链分享</title>
	</head>
	<body style="background:#eee;">
		<div class="container">
			<!--公共的title-->
			<header class="topbar">
				<a id="hdId" onclick='goBack()' href="javascript:;" class="iconfont icon-arrowlf btn_back pull-left"></a>
				<span class="title">暴走熊猫</span>
			</header>
			<section  class="gifArea">
				<div class="gifWrap">
					<img src="images/giffer3.gif" alt="" data-gifffer="images/giffer3.gif"/>
				</div>
			</section>
		</div>
		<!--此页面单独引用插件-->
		<script>
			$(function(){
			    Gifffer();
			})
			var Gifffer = function() {
		    var images, d = document, ga = 'getAttribute', sa = 'setAttribute';
		    images = d && d.querySelectorAll ? d.querySelectorAll('[data-gifffer]') : [];
		    var createContainer = function(w, h, el) {
		        var con = d.createElement('DIV'), cls = el[ga]('class'), id = el[ga]('id');
		        cls ? con[sa]('class', el[ga]('class')) : null;
		        id ? con[sa]('id', el[ga]('id')) : null;
		        con[sa]('style', 'position:relative;cursor:pointer;width:' + w + 'px;height:' + h + 'px;');
		        //hxn20170601
		        con[sa]('class','flag')
		        //添加广告-文字广告
		        var gifadword=d.createElement("span");
		        var state='3';
		        switch(state){
		        	case"1":
		        	gifadword[sa]('class','gifTxt gifTxtlt watermark');
		        	break;
		        	case"2":
		        	gifadword[sa]('class','gifTxt gifTxtlb watermark');
		        	break;
		        	case"3":
		        	gifadword[sa]('class','gifTxt gifTxtrt watermark');
		        	break;
		        	case"4":
		        	gifadword[sa]('class','gifTxt gifTxtrb watermark');
		        	break;
		        }
		        gifadword.innerHTML='水印广告你说那肯定放假过儿童节';
		        // creating play button
		        var play = d.createElement('DIV');
		        play[sa]('style', 'width:100%;height:100%;background:rgba(0, 0, 0, 0.3);position:absolute;left:' + 0 + 'px;top:' + 0 + 'px;');
		        var hxn = d.createElement('IMG');
		        
		        hxn[sa]('src','images/gif_03.png');
		        hxn[sa]('style','width:1rem;height:1rem;position:absolute;margin-top:-0.5rem;top:50%;left:50%;;margin-left:-0.5rem;')
		        play.appendChild(hxn);
		        con.appendChild(gifadword);
		        // dom placement
		        con.appendChild(play);
		        el.parentNode.replaceChild(con, el);
		        return {c: con, p: play };
		    }
		    var process = function(el) {
		        var url, con, c, w, h, play, gif, playing = false, cc, isC;
		        url = el[ga]('data-gifffer');
		        w = el[ga]('data-gifffer-width');
		        h = el[ga]('data-gifffer-height');
		        el.style.display = 'block';
		        c = document.createElement('canvas');
		        //hxn20170601
		        c[sa]('style','position:absolute;top:0;left:0;');
		        isC = !!(c.getContext && c.getContext('2d'));
		        if(w && h && isC) cc = createContainer(w, h, el);
		        el.onload = function() {
		            if(isC) {
		                w = w || el.width;
		                h = h || el.height;
		                // creating the container
		                if(!cc) cc = createContainer(w, h, el);
		                con = cc.c;
		                play = cc.p;
		                con.addEventListener('click', function() {
		                    if(!playing) {
		                        playing = true;
		                        gif = d.createElement('IMG');
		                        gif[sa]('style', 'width:' + w + 'px;height:' + h + 'px;');
		                        gif[sa]('data-uri', Math.floor(Math.random()*100000) + 1);
		                        setTimeout(function() {
		                            gif.src = url;
		                        }, 0);                        
		                        con.removeChild(play);
		                        con.removeChild(c);
		                        con.appendChild(gif);
		                    } else {
		                        playing = false;
		                        con.appendChild(play);
		                        con.removeChild(gif);
		                        con.appendChild(c);
		                        gif = null;
		                    }
		                });
		                // canvas
		                c.width = w;
		                c.height = h;
		                c.getContext('2d').drawImage(el, 0, 0, w, h);
		                con.appendChild(c);
		            }
		        }
		        el.src = url;
		    }
		    for(var i=0; i<images.length; i++) process(images[i]);
		}
		</script>
	</body>
</html>
